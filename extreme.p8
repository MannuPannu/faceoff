pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

bullets = {}
bullet_speed = 3.5

cam={
  x=0,
  y=0,
  allowanceX=40,
  allowanceY=40
 }

function create_player()
	local x = 64
	local y = 64
	local x_vel = 0
 	local y_vel = 0
	local acc = 0.6
	local max_speed = 3.5
	local direction = 0
	local friction = 0.6
	local move_left = true
	local sprite_index = 1
	local cool_down = 0.2
	local can_fire_time = 0

	local p = {
		draw = function()
			spr(direction + 1, x, y, 1, 1)
		end,
		update = function()
			x += x_vel
			y += y_vel

			--friction
			x_vel *= friction
			y_vel *= friction
			
			--cap max speed
			 if abs(vel_y) > max_speed then
				 vel_y = sgn(vely) * max_speed
			 end

			 if abs (vel_x) > max_speed then
			  	vel_x = sgn(vel_x) * max_speed
			 end
			 -- zero speed
			 if abs(x_vel) < 0.1 then x_vel = 0 end
			 if abs(y_vel) < 0.1 then y_vel = 0 end
		end,
		move_left = function()
			x_vel -= acc
			set_dir()
		end,
		move_right = function()
			x_vel += acc
			set_dir()
		end,
		move_down = function()
			y_vel += acc 
			set_dir()
		end,
		move_up = function()
			y_vel -= acc
			set_dir()
		end,
		fire_gun = function()
			if (can_fire_time < t()) then 
				sfx(0)

				b = {x = x+4, y = y+4, x_vel = 0, y_vel = 0}

				if(direction == 0) then 
					b.x_vel = -bullet_speed
					b.y_vel = 0
				elseif (direction == 1) then
					b.x_vel = -bullet_speed
					b.y_vel = -bullet_speed
				elseif (direction == 2) then
					b.x_vel = 0
					b.y_vel = -bullet_speed
				elseif (direction == 3) then
					b.x_vel = bullet_speed
					b.y_vel = -bullet_speed
				elseif (direction == 4) then
					b.x_vel = bullet_speed
					b.y_vel = 0
				elseif (direction == 5) then
					b.x_vel = bullet_speed
					b.y_vel = bullet_speed
				elseif (direction == 6) then
					b.x_vel = 0
					b.y_vel = bullet_speed
				elseif (direction == 7) then
					b.x_vel = -bullet_speed
					b.y_vel = bullet_speed
				end
				add(bullets, b)
				can_fire_time = t() + cool_down
			end
		
		end,
		get_dir = function()
			return direction
		end,
		get_info = function() 
			return {x = x, y= y, x_vel = x_vel, y_vel = y_vel}
		end
 	}

 	function set_dir()
		if (x_vel < 0 and y_vel == 0) then direction = 0 end
		if(x_vel < 0 and y_vel < 0) then direction = 1 end

		if (y_vel < 0 and x_vel == 0) then direction = 2 end
		if(y_vel < 0 and x_vel > 0) then direction = 3 end

		if (x_vel > 0 and y_vel == 0) then direction = 4 end
		if(x_vel > 0 and y_vel > 0) then direction = 5 end

		if (y_vel > 0 and x_vel == 0) then direction = 6 end
		if(y_vel > 0 and x_vel < 0) then direction = 7 end
	end
 
 	return p
end

function _init()
	player = create_player()
end


function _update()
	get_input(player)
	player.update()

	for bullet in all(bullets) do
		move_entity(bullet)
	end
	p_info = player.get_info()

	if(p_info.x > (cam.x + 128 - cam.allowanceX)) then
	 	cam.x = (p_info.x - 128 + cam.allowanceX)
	end
	if(p_info.x < (cam.x + cam.allowanceX)) then
		cam.x = (p_info.x - cam.allowanceX)
	end

	if(p_info.y > (cam.y + 128 - cam.allowanceY)) then
	 	cam.y = (p_info.y - 128 + cam.allowanceY)
	end
	if(p_info.y < (cam.y + cam.allowanceY)) then
		cam.y = (p_info.y - cam.allowanceY)
	end

	if(cam.y < 0) then cam.y = 0 end
	if(cam.y > (1024-128)) then cam.y = 1024-128 end

	if(cam.x < 0) then cam.x = 0 end
	if(cam.x > (1024-128)) then cam.x = 1024-128 end
end

function move_entity(e)
	e.x += e.x_vel
	e.y += e.y_vel
end

function get_input(e)
	if btn(0) then e.move_left() end
	
	if btn(1) then e.move_right() end

	if btn(2) then e.move_up() end
		
	if btn(3) then e.move_down() end

	if btn(4) then e.fire_gun() end
end

function _draw()

	camera()
	rectfill(0, 0, 128, 128, 0)
	camera(cam.x, cam.y)

	for bullet in all(bullets) do
		pset(bullet.x, bullet.y, 7)
	end

	map(0, 0, 0, 0, 128, 32)
	player.draw()

	camera()
	
	print("extreme pubg", 50, 5, 7)
	print(#bullets, 5, 5, 7)

	print(cam.x, 5, 10, 7)
	--print(cam.y, 10, 10, 7)
end
__gfx__
00000000008888000088880000088000008888000088880000888800000880000088880000000000000000000000000000000000000000000000000000000000
00000000000ff800600f8800000880000088f006008ff000008ff000000ff000000ff80000000000000000000000000000000000000000000000000000000000
00700700000fff00060fff00006ff00000fff06000fff00000fff000000ff000000fff0000000000000000000000000000000000000000000000000000000000
00077000008888000668880000888800008886600088880000888800008888000088880000000000000000000000000000000000000000000000000000000000
00077000666688000f68880000888880008886f00088666600886600006888800066880000000000000000000000000000000000000000000000000000000000
00700700008f880000888800006888f0008888000088f8000088f600006888f0006f880000000000000000000000000000000000000000000000000000000000
00000000008008000580080000080800008008500080080000805860006808000685080000000000000000000000000000000000000000000000000000000000
00000000055055000050550000050500005505000055055000550506000505006050550000000000000000000000000000000000000000000000000000000000
00000000566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011
1111111111111111000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011
1100000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011
1100000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100001c30037350323502e350263501d3502f30000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300003000030000300
